generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model scraping_jobs {
  id             String      @id @default(dbgenerated("gen_random_uuid()"))
  userId         String
  originalPrompt String
  analysisPrompt String?
  snapshotId     String?
  status         Status
  result         Json?
  requestType    RequestType @default(BASIC)
  seoReport      String?
  error          String?
  completedAt    DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @default(now())
  user           user        @relation(fields: [userId], references: [id], onDelete: Cascade)

  report_progress report_progress?

  @@index([status, createdAt, userId])
}

model user {
  id                 String               @id
  name               String
  email              String               @unique
  emailVerified      Boolean              @default(false)
  image              String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  scraping_jobs      scraping_jobs[]
  walletTransactions WalletTransactions[]
}

model report_progress {
  id        String        @id @default(dbgenerated("gen_random_uuid()"))
  jobId     String        @unique
  progress  Float
  failed    Boolean       @default(false)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @default(now())
  Job       scraping_jobs @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId])
}

model WalletTransactions {
  id              String          @id @default(dbgenerated("gen_random_uuid()"))
  userId          String
  authToken       String?
  merchantOrderId String?
  metaInfo        Json
  paymentFlow     String
  phonepeOrderId  String?
  transactionId   String?
  amount          Float
  description     String?
  status          String
  type            TransactionType
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now())
  user            user            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum Status {
  PENDING
  RUNNING
  ANALYSING
  COMPLETED
  FAILED
}

enum TransactionType {
  CREDIT
  DEBIT
}

enum RequestType {
  SMART
  BASIC
}
